window.OB_D2C=window.OB_D2C||{},window.OB_D2C.settingsService=window.OB_D2C.settingsService||{getSettings:function(e){var t=localStorage.getItem("settingsBaseUrl")||"https://settings.outbrain.com/D2CSettings/";return t+="api/getSettings",$.ajax({type:"POST",url:t,data:JSON.stringify(e),contentType:"application/json",xhrFields:{withCredentials:!0}})}},window.OB_D2C.auditService=window.OB_D2C.auditService||{eventTypes:{widget_icon_impression:1e3,widget_icon_viewed:1100,widget_icon_click:1200,lightbox_opened:1300,lightbox_ready:1350,lightbox_closed:1400},sendEvent:function(e){var t=localStorage.getItem("auditBaseUrl")||"https://audit.outbrain.com/D2CAudit/";t+="api/audit";var n=jQuery.extend({eventGroup:"acquisition",localDatetime:window.OB_D2C.helpers.getFormattedDate(),apiKey:"fcbbefdef2134fcf8071e1c43340fd52"},e);return jQuery.ajax({type:"POST",url:t,data:JSON.stringify(n),contentType:"application/json",xhrFields:{withCredentials:!0}})}},window.OB_D2C.helpers=window.OB_D2C.helpers||{getUrlParams:function(){var e={},t=(window.location.search.split("?")[1]||"").split("&");for(var n in t)t.hasOwnProperty(n)&&(paramParts=t[n].split("="),e[paramParts[0]]=decodeURIComponent(paramParts[1]||""));return e},attachQueryToUrl:function(e,t){if(!t)return e;var n=e.indexOf("?")>=0;n||(e+="?");for(var o in t)t.hasOwnProperty(o)&&(n?e+="&":n=!0,e+=o+"="+t[o]);return e},getDocumentUrl:function(){var e=window.location.href;return window.self!==window.top&&(e=window.parent.location.href),e},getFormattedDate:function(){var e=function(e){return e>=10?e:"0"+e},t=new Date,n=e(t.getDate()),o=e(t.getMonth()+1),i=e(t.getHours()),d=e(t.getMinutes()),a=e(t.getSeconds()),r=t.getMilliseconds();return[t.getFullYear(),"-",o,"-",n," ",i,":",d,":",a,".",r].join("")},elementInViewport:function(e){if(!e||!e.offset())return!1;var t=jQuery(window),n=t.scrollTop(),o=t.scrollTop()+t.height(),i=e.offset().top+e.outerHeight();return o>=i&&n<=i}},window.OB_D2C.init=window.OB_D2C.init||function(e){var t=this,n=window.OB_D2C_PROXY.getWidgetId(e);n&&t.checkJquery(function(){var o=jQuery('[data-widget-id="'+n+'"]'),i=o.height(),d=o.width(),a=jQuery(window).width(),r=jQuery(window).height();if(o.length){var c={settingsGroup:"widget",data:{docUrl:window.OB_D2C.helpers.getDocumentUrl(),widgetJsId:n,widgetRecMode:window.OB_D2C_PROXY.getSet(e,"recMode",null),widgetResolutionHeight:i,widgetResolutionWidth:d,screenResolutionHeight:r,screenResolutionWidth:a}};t.settingsService.getSettings(c).then(function(n){if(n.success){var i=n.data;if(!i.settings||!i.settings.enable)return;t.loadCSS(function(){t.ctaInit(e,o,i)})}})}})},window.OB_D2C.loadJquery=window.OB_D2C.loadJquery||function(e){var t="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js",n=document.createElement("script");n.src=t;var o=document.getElementsByTagName("head")[0],i=!1;n.onload=n.onreadystatechange=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(i=!0,"undefined"==typeof jQuery?console.log("Failed to load jQuery"):e&&e(),n.onload=n.onreadystatechange=null,o.removeChild(n))},o.appendChild(n)},window.OB_D2C.checkJquery=window.OB_D2C.checkJquery||function(e){var t=this;if(window.OB_D2C_PROXY&&window.OB_D2C_PROXY.hasJqueryInstalled()){var n=jQuery&&jQuery.fn&&jQuery.fn.jquery?jQuery.fn.jquery:null;if(n){var o=n.split(".");if(parseInt(o[0])<2)return void t.loadJquery(e)}"undefined"==typeof jQuery&&"function"==typeof $&&$.noConflict(),e()}else t.loadJquery(e)},window.OB_D2C.loadCSS=window.OB_D2C.loadCSS||function(e){var t="http://libs.sphere.com/d2c/dist/css/d2c.css",n=jQuery('<link rel="stylesheet" href="'+t+'" type="text/css" media="screen" />');n.load(e),jQuery("head").append(n)},window.OB_D2C.loadFacebook=window.OB_D2C.loadFacebook||function(e,t){var n=function(){FB.init({appId:e,xfbml:!0,version:"v2.6"}),t&&t()};return"undefined"!=typeof FB?void n():(window.fbAsyncInit=function(){n()},void function(e,t,n){var o,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk"))},window.OB_D2C.ctaInit=window.OB_D2C.ctaInit||function(e,t,n){var o=this,i=n.settings,d=n.sessionId,a=1,r=t.find(".ob_what");if(r.length){var c=i.ctaType&&window.OB_D2C.ctaFactory[i.ctaType]?i.ctaType:"cta_a",s=jQuery('<div class="ob_d2c_cta '+c+'" title="Outbrain for Chat"></div>');r.html(s);var p=t.find(".ob_d2c_cta"),_=i.ctaText||"Chat with us",u=window.OB_D2C.ctaFactory[c],w=u.getContent(_);p.html(jQuery(w)),window.OB_D2C.auditService.sendEvent({sessionId:d,eventId:window.OB_D2C.auditService.eventTypes.widget_icon_impression,abVariantIds:[n.configSetId],iconTypes:[a],referenceDomain:document.referrer,acquisitionChannel:"widget",pageViewId:window.OB_D2C_PROXY.getRequest(e,"pvId",""),recRequestId:window.OB_D2C_PROXY.getRequest(e,"req_id","")}),t.on("click",".ob_d2c_cta",function(e){e.stopPropagation(),window.OB_D2C.auditService.sendEvent({sessionId:d,eventId:window.OB_D2C.auditService.eventTypes.widget_icon_click,iconType:a}),o.openPopup(i,d,t)});var l=u.viewCallback(t,d);jQuery(window).scroll(l),jQuery("body").on("touchmove",l),l()}},window.OB_D2C.ctaFactory=window.OB_D2C.ctaFactory||{cta_a:{getContent:function(e){var t='<div class="ob_d2c_cta_content_wrapper"><span class="ob_d2c_cta_icon"></span><div class="ob_d2c_cta_content_boxes"><span class="ob_d2c_cta_content">'+e+'</span><div class="ob_d2c_cta_loader"><span></span><span></span><span></span></div></div></div>';return t},viewCallback:function(e,t){var n=function(){var n=e.find(".ob_d2c_cta"),o=window.OB_D2C.helpers.elementInViewport(n),i=e.find(".ob_d2c_cta_content_boxes");o?(i.addClass("switch_content"),n.hasClass("viewed")||(n.addClass("viewed"),window.OB_D2C.auditService.sendEvent({sessionId:t,eventId:window.OB_D2C.auditService.eventTypes.widget_icon_viewed}))):i.removeClass("switch_content")};return n}},cta_b:{getContent:function(e){var t='<div class="ob_d2c_cta_content_wrapper"><div class="ob_d2c_cta_tooltip">'+e+'</div><div class="od_d2c_cta_messanger_icon"></div><div class="ob_d2c_cta_large_messanger_button"><span class="ob_d2c_cta_amelia_messanger"></span><span>Get My News <strong>with Outbrain</strong></span> </div></div>';return t},viewCallback:function(e,t){var n=function(){var n=e.find(".ob_d2c_cta"),o=window.OB_D2C.helpers.elementInViewport(n),i=e.find(".od_d2c_cta_messanger_icon"),d=null,a=null;i.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){console.log("messangerTransitioned")},!1),o?(n.hasClass("viewed")||(n.addClass("viewed"),window.OB_D2C.auditService.sendEvent({sessionId:t,eventId:window.OB_D2C.auditService.eventTypes.widget_icon_viewed})),n.hasClass("cta_in")||n.hasClass("cta_in_done")||(n.addClass("cta_in"),a=window.setTimeout(function(){n.addClass("cta_in_done"),d=window.setTimeout(function(){n.removeClass("cta_in")},1e3)},4e3))):(a&&window.clearTimeout(a),d&&window.clearTimeout(d),n.removeClass("cta_in"),n.removeClass("cta_in_done"))};return n}},text:{getContent:function(e){return"<span>"+e+"</span>"},viewCallback:function(e,t){var n=function(){var n=e.find(".ob_d2c_cta"),o=window.OB_D2C.helpers.elementInViewport(n);e.find(".ob_d2c_cta_content_boxes");o&&(n.hasClass("viewed")||(n.addClass("viewed"),window.OB_D2C.auditService.sendEvent({sessionId:t,eventId:window.OB_D2C.auditService.eventTypes.widget_icon_viewed})))};return n}}},window.OB_D2C.openPopup=window.OB_D2C.openPopup||function(e,t,n){var o=e.popupType&&window.OB_D2C.popupFactory[e.popupType]?e.popupType:"popup",i=window.OB_D2C.popupFactory[o];i.open(e,t,n),i.attachEvents(t)},window.OB_D2C.popupFactory=window.OB_D2C.popupFactory||{popup:{open:function(e,t,n){if(jQuery.find(".ob_d2c_popup_wrapper").length)return void jQuery(".ob_d2c_popup_wrapper").remove();var o='<div class="ob_d2c_popup_wrapper popup"><div class="ob_d2c_dark_bg"></div><div class="ob_d2c_popup"><button class="ob_d2c_close_popup"></button><div class="ob_d2c_popup_content"></div>',i=jQuery(window).scrollTop();jQuery("body").append(o);var d=jQuery(".ob_d2c_popup_content"),a=window.OB_D2C.helpers.attachQueryToUrl(e.popupUrl,{sessionId:t}),r=jQuery('<iframe src="'+a+'" style="border: none; width: 100%; height: 100%; position: absolute;"></iframe>');d.append(r);var c=jQuery(".ob_d2c_popup"),s=e.popupWidth,p=e.popupHeight,_=jQuery(window).height(),u=p+p/2>_?20:(_-e.popupHeight)/2;c.css({top:i,height:p,width:s,marginLeft:-(e.popupWidth/2),marginTop:u})},attachEvents:function(e){var t=jQuery(".ob_d2c_popup"),n=function(t){window.OB_D2C.auditService.sendEvent({sessionId:e,eventId:window.OB_D2C.auditService.eventTypes.lightbox_closed,attr:{closeTrigger:t}}),jQuery(".ob_d2c_popup_wrapper").remove()};t.off("click",".ob_d2c_close_popup",n).on("click",".ob_d2c_close_popup",function(){n("x_button")}),jQuery(".ob_d2c_dark_bg").off("click",n).on("click",function(){n("click_on_screen")})}},overWidget:{open:function(e,t,n){if(jQuery.find(".ob_d2c_popup_wrapper").length)return void jQuery(".ob_d2c_popup_wrapper").remove();var o=n.find(".ob-widget"),i='<div class="ob_d2c_popup_wrapper over_widget"><div class="popup_overlay"><div class="ob_d2c_popup_over_widget"><button class="ob_d2c_close_popup"></button><div class="ob_d2c_popup_content"></div>';jQuery("body").append(i);var d=e.popupWidth,a=e.popupHeight,r=n.outerHeight(!0)>=o.outerHeight(!0)?n:o,c=n.outerWidth(!0)>=o.outerWidth(!0)?n:o,s=r.outerHeight(!0),p=c.outerWidth(!0),_=jQuery(".popup_overlay"),u=jQuery(".ob_d2c_popup_content"),w=window.OB_D2C.helpers.attachQueryToUrl(e.popupUrl,{sessionId:t}),l=jQuery('<iframe src="'+w+'" style="border: none; width: 100%; height: 100%; position: absolute;"></iframe>');u.append(l);var v=jQuery(".ob_d2c_popup_over_widget"),f=r.offset().top-parseInt(r.css("marginTop")||0);_.css({height:s,width:p,top:f,left:c.offset().left}),v.css({height:a,width:d,left:p/2-e.popupWidth/2,top:30})},attachEvents:function(e){var t=jQuery(".ob_d2c_popup_over_widget"),n=function(t){window.OB_D2C.auditService.sendEvent({sessionId:e,eventId:window.OB_D2C.auditService.eventTypes.lightbox_closed,attr:{closeTrigger:t}}),jQuery(".ob_d2c_popup_wrapper").remove()};t.off("click",".ob_d2c_close_popup",n).on("click",".ob_d2c_close_popup",function(){n("x_button")}),jQuery(".popup_overlay").off("click",n).on("click",function(){n("click_on_screen")})}}},function(){window.OB_D2C_PROXY&&window.OB_D2C_PROXY.makeHandshake()}();